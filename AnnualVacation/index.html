<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vacation Planner (Vanilla JS)</title>
  <style>
    :root {
      --ink:#1f2937; --muted:#6b7280; --bg:#f3f4f6; --card:#ffffff;
      --brand:#0F2133; --brand-d:#08121a; --ok:#16a34a; --warn:#ca8a04; --bad:#dc2626;
      --ring:#2a4561;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif; color:var(--ink); background:var(--bg); }
    .container { max-width: 1024px; margin: 24px auto; padding: 0 16px; }
    .card { background:var(--card); border-radius:12px; box-shadow: 0 8px 24px rgba(0,0,0,.08); padding:24px; }
    h1 { margin:0 0 16px; font-size:28px; }
    h2 { margin:24px 0 8px; font-size:18px; }
    .row { display:flex; gap:12px; align-items:center; }
    .row.wrap { flex-wrap: wrap; }
    .col { flex:1; min-width: 220px; }
    label { display:block; font-size:14px; color:var(--muted); margin-bottom:6px; }
    input[type="text"], input[type="date"] {
      width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:10px; outline:none;
    }
    input:focus { border-color:#93c5fd; box-shadow:0 0 0 4px rgba(2,132,199,.15); }
    .toolbar { display:flex; gap:8px; }
    button {
      appearance:none; border:0; border-radius:10px; padding:10px 14px; font-weight:600; cursor:pointer;
      background:var(--brand); color:white;
    }
    button.secondary { background:#6b7280; }
    button.ghost { background:transparent; color:#2563eb; padding:0; }
    button.ok { background:var(--ok); }
    button.bad { background:var(--bad); }
    button.warn { background:#374151; }
    button:disabled { opacity:.5; cursor:not-allowed; }
    .pill { padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700; display:inline-block; }
    .PENDING { background:#fef3c7; color:#92400e; }
    .APPROVED { background:#dcfce7; color:#166534; }
    .REJECTED { background:#fee2e2; color:#991b1b; }
    table { width:100%; border-collapse: collapse; }
    th, td { padding:12px; text-align:left; border-bottom:1px solid #f1f5f9; vertical-align: top; }
    thead th { font-size:12px; letter-spacing:.06em; color:#6b7280; text-transform:uppercase; }
    .muted { color:var(--muted); }
    .statbar { display:flex; justify-content:space-between; background:#f8fafc; padding:10px 12px; border-radius:10px; }
    .chip-btn { width:28px; height:28px; border-radius:999px; display:grid; place-items:center; font-weight:800; }
    .center { text-align:center; }
    .hidden { display:none !important; }
    .notice {
      position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:50;
    }
    .notice .panel { background:white; border-radius:12px; padding:20px; width:min(420px, 92vw); text-align:center; }
    .space { height:12px; }
    .nav { display:flex; gap:12px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card" id="view-home">
      <h1>Vacation Planner</h1>
      <div class="nav">
        <button id="go-employee">Employee Vacation Request</button>
        <button id="go-supervisor" class="warn">Supervisor Dashboard</button>
      </div>
      <p class="muted" style="margin-top:12px">This build is pure HTML + vanilla JS. If Firebase config is present it will persist to Firestore; otherwise it runs in memory.</p>
    </div>

    <!-- Employee -->
    <div class="card hidden" id="view-employee">
      <div class="toolbar" style="margin-bottom:8px">
        <button class="ghost" id="back-from-employee">&larr; Back to Home</button>
      </div>
      <h1>Employee Vacation Request</h1>

      <div class="row wrap">
        <div class="col">
          <label for="emp-name">Name</label>
          <input id="emp-name" type="text" placeholder="Your name" />
        </div>
        <div class="col">
          <label for="emp-seniority">Seniority Date</label>
          <input id="emp-seniority" type="date" />
        </div>
      </div>

      <div class="statbar" style="margin-top:12px">
        <div>Years of Service: <strong id="stat-years">0</strong></div>
        <div>Weeks of Vacation: <strong id="stat-weeks">0</strong></div>
      </div>

      <h2 style="margin-top:16px">Request Weeks</h2>
      <div class="row" style="justify-content:space-between; align-items:center">
        <div class="muted">Week <strong id="wk-index">1</strong> of <strong id="wk-total">0</strong></div>
        <div class="toolbar">
          <button id="btn-add-option" class="chip-btn" title="Add option">+</button>
          <button id="btn-remove-option" class="chip-btn warn" title="Remove option">&minus;</button>
        </div>
      </div>

      <div id="options-wrap" style="margin-top:8px"></div>

      <div class="toolbar" style="justify-content:space-between; margin-top:16px">
        <div>
          <button id="btn-prev" class="secondary">Previous</button>
        </div>
        <div>
          <button id="btn-next">Next</button>
          <button id="btn-submit" class="ok hidden">Submit Request</button>
        </div>
      </div>
    </div>

    <!-- Supervisor -->
    <div class="card hidden" id="view-supervisor">
      <div class="toolbar" style="margin-bottom:8px">
        <button class="ghost" id="back-from-supervisor">&larr; Back to Home</button>
      </div>
      <h1>Supervisor Dashboard</h1>

      <div class="toolbar" style="justify-content:space-between; margin-bottom:8px">
        <div class="toolbar">
          <button id="btn-allocate">Allocate Vacations</button>
          <button id="btn-reset" class="secondary">Reset All Requests</button>
        </div>
        <span class="muted">Sorted by seniority (oldest first)</span>
      </div>

      <div class="card" style="padding:0">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Seniority Date</th>
              <th>Years</th>
              <th>Requested Dates</th>
              <th>Status</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="requests-tbody">
            <tr><td colspan="6" class="center muted">Loading…</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Message Modal -->
  <div class="notice" id="notice">
    <div class="panel">
      <div id="notice-text" style="margin-bottom:12px">Hello</div>
      <button id="notice-close">Close</button>
    </div>
  </div>

  <!-- OPTIONAL Firebase (works if you already expose window.firebaseConfig, window.appId, window.initialAuthToken) -->
  <script type="module">
    // If you don't provide firebaseConfig, we skip imports and run in-memory.
    const hasFirebaseConfig = typeof window.firebaseConfig !== 'undefined' && window.firebaseConfig && Object.keys(window.firebaseConfig).length > 0;

    if (hasFirebaseConfig) {
      const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js");
      const { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } =
        await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js");
      const {
        getFirestore, collection, query, onSnapshot, doc, addDoc, updateDoc, serverTimestamp, getDocs
      } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js");

      window._fb = { initializeApp, getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged,
        getFirestore, collection, query, onSnapshot, doc, addDoc, updateDoc, serverTimestamp, getDocs };
    }
  </script>

  <!-- Main App (Vanilla JS) -->
  <script>
    /*********** State ***********/
    const state = {
      // roleless UI; supervisor view is just a page
      name: 'John Doe',
      seniorityDate: '2015-01-01',
      years: 0,
      weeks: 0,
      currentWeekIndex: 0,
      vacationDates: [], // Array< Array<{startDate,endDate}> >
      // data source
      backend: {
        mode: 'memory', // 'memory' | 'firestore'
        userId: 'local-user',
        ready: false,
        // firestore bits
        db: null,
        appId: window.appId || 'default-app-id'
      },
      supervisor: {
        items: [] // from backend
      }
    };

    /*********** DOM helpers ***********/
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const show = el => el.classList.remove('hidden');
    const hide = el => el.classList.add('hidden');

    const views = {
      home: $('#view-home'),
      employee: $('#view-employee'),
      supervisor: $('#view-supervisor')
    };

    function navigate(to) {
      Object.values(views).forEach(hide);
      show(views[to]);
      if (to === 'supervisor') {
        loadSupervisor();
      }
    }

    function notify(msg, ms=3000) {
      $('#notice-text').textContent = msg;
      $('#notice').style.display = 'flex';
      if (notify._t) clearTimeout(notify._t);
      notify._t = setTimeout(() => $('#notice').style.display = 'none', ms);
    }
    $('#notice-close').addEventListener('click', () => $('#notice').style.display = 'none');

    /*********** Employee view wiring ***********/
    const $name       = $('#emp-name');
    const $seniority  = $('#emp-seniority');
    const $years      = $('#stat-years');
    const $weeks      = $('#stat-weeks');
    const $wkIndex    = $('#wk-index');
    const $wkTotal    = $('#wk-total');
    const $optionsWrap= $('#options-wrap');
    const $btnPrev    = $('#btn-prev');
    const $btnNext    = $('#btn-next');
    const $btnSubmit  = $('#btn-submit');
    const $btnAddOpt  = $('#btn-add-option');
    const $btnRemOpt  = $('#btn-remove-option');

    function fmtDateISOToMDY(iso) {
      if (!iso) return '';
      const d = new Date(iso);
      if (Number.isNaN(d.getTime())) return '';
      const mm = String(d.getUTCMonth()+1).padStart(2,'0');
      const dd = String(d.getUTCDate()).padStart(2,'0');
      const yy = d.getUTCFullYear();
      return `${mm}/${dd}/${yy}`;
    }

    function recomputeFromSeniority() {
      const sd = $seniority.value || '';
      if (!sd) { state.years = 0; state.weeks = 0; paintEmployeeStats(); return; }
      const start = new Date(sd);
      const today = new Date();
      const diffYears = Math.floor((today - start) / (1000*3600*24*365.25));
      state.years = Math.max(0, diffYears);

      let w = 0;
      if (state.years >= 35) w = 6;
      else if (state.years >= 25) w = 5;
      else if (state.years >= 10) w = 4;
      else if (state.years >= 3)  w = 3;
      else if (state.years >= 1)  w = 2;

      state.weeks = w;

      // ensure vacationDates length matches weeks
      const cur = state.vacationDates || [];
      const next = Array.from({length:w}, (_,i)=> cur[i] ? cur[i] : [{startDate:'', endDate:''}]);
      state.vacationDates = next;
      if (state.currentWeekIndex >= w) state.currentWeekIndex = Math.max(0, w-1);

      paintEmployeeStats();
      paintWeek();
    }

    function paintEmployeeStats() {
      $years.textContent = state.years;
      $weeks.textContent = state.weeks;
      $wkIndex.textContent = (state.weeks===0 ? 0 : state.currentWeekIndex+1);
      $wkTotal.textContent = state.weeks;
      $btnPrev.disabled = (state.currentWeekIndex === 0);
      hide($btnSubmit);
      hide($btnNext);
      if (state.weeks>0) {
        if (state.currentWeekIndex < state.weeks - 1) show($btnNext);
        else show($btnSubmit);
      }
    }

    function paintWeek() {
      $optionsWrap.innerHTML = '';
      if (state.weeks===0) return;
      const arr = state.vacationDates[state.currentWeekIndex] || [{startDate:'', endDate:''}];

      arr.forEach((opt, idx) => {
        const wrap = document.createElement('div');
        wrap.className = 'card';
        wrap.style.padding = '12px';
        wrap.style.margin = '8px 0';

        const label = document.createElement('div');
        label.className = 'muted';
        label.textContent = `Option ${idx+1}`;
        wrap.appendChild(label);

        const row = document.createElement('div');
        row.className = 'row wrap';
        const col1 = document.createElement('div'); col1.className='col';
        const col2 = document.createElement('div'); col2.className='col';

        const l1 = document.createElement('label'); l1.textContent='Start Date';
        const i1 = document.createElement('input'); i1.type='date';
        i1.min = '2026-01-01'; i1.max='2026-12-31'; i1.value = opt.startDate || '';
        i1.addEventListener('change', e => {
          state.vacationDates[state.currentWeekIndex][idx].startDate = e.target.value;
        });

        const l2 = document.createElement('label'); l2.textContent='End Date';
        const i2 = document.createElement('input'); i2.type='date';
        i2.min = '2026-01-01'; i2.max='2026-12-31'; i2.value = opt.endDate || '';
        i2.addEventListener('change', e => {
          state.vacationDates[state.currentWeekIndex][idx].endDate = e.target.value;
        });

        col1.append(l1,i1); col2.append(l2,i2);
        row.append(col1,col2);
        wrap.appendChild(row);
        $optionsWrap.appendChild(wrap);
      });

      // option buttons visibility
      const canAdd = (state.vacationDates[state.currentWeekIndex]?.length || 0) < 2;
      const canRem = (state.vacationDates[state.currentWeekIndex]?.length || 0) > 1;
      $btnAddOpt.disabled = !canAdd;
      $btnRemOpt.disabled = !canRem;
    }

    function addOption() {
      const arr = state.vacationDates[state.currentWeekIndex];
      if (arr.length < 2) {
        arr.push({startDate:'', endDate:''});
        paintWeek();
      }
    }
    function removeOption() {
      const arr = state.vacationDates[state.currentWeekIndex];
      if (arr.length > 1) {
        arr.splice(1,1);
        paintWeek();
      }
    }

    function allDatesFilled() {
      return state.vacationDates.every(week => week.every(o => o.startDate && o.endDate));
    }

    async function submitRequest() {
      if (!$name.value || !$seniority.value) { notify("Please fill in your name and seniority date."); return; }
      if (state.weeks === 0) { notify("You currently have 0 vacation weeks."); return; }
      if (!allDatesFilled()) { notify("Please fill in all requested vacation dates."); return; }

      const payload = {
        name: $name.value,
        seniorityDate: $seniority.value,
        vacationDates: JSON.stringify(state.vacationDates),
        yearsOfService: state.years,
        status: 'pending',
        userId: state.backend.userId,
        submittedAt: Date.now()
      };

      try {
        await backendAdd(payload);
        // reset
        state.name='John Doe'; state.seniorityDate='2015-01-01';
        $name.value = state.name; $seniority.value = state.seniorityDate;
        state.currentWeekIndex = 0;
        recomputeFromSeniority();
        notify("Vacation request submitted successfully!");
      } catch(e) {
        console.error(e);
        notify("Failed to submit request. Please try again.");
      }
    }

    /*********** Supervisor view ***********/
    const $tbody = $('#requests-tbody');

    function paintSupervisor() {
      const items = [...state.supervisor.items];
      // oldest seniority first
      items.sort((a,b)=> new Date(a.seniorityDate) - new Date(b.seniorityDate));

      if (!items.length) {
        $tbody.innerHTML = `<tr><td colspan="6" class="center muted">No vacation requests at this time.</td></tr>`;
        return;
      }

      $tbody.innerHTML = '';
      items.forEach(req => {
        const tr = document.createElement('tr');
        const vdates = Array.isArray(req.vacationDates) ? req.vacationDates : [];
        const datesHTML = vdates.map((week, i) => {
          const lines = (Array.isArray(week) ? week : []).map((o, j) =>
            `<div class="muted" style="font-size:12px">Option ${j+1}: ${fmtDateISOToMDY(o.startDate)} to ${fmtDateISOToMDY(o.endDate)}</div>`
          ).join('');
          return `<div style="margin-bottom:6px"><strong>Week ${i+1}:</strong><div>${lines || '<span class="muted">No dates</span>'}</div></div>`;
        }).join('');

        tr.innerHTML = `
          <td>${req.name}</td>
          <td class="muted">${fmtDateISOToMDY(req.seniorityDate)}</td>
          <td class="muted">${req.yearsOfService ?? ''}</td>
          <td>${datesHTML || '<span class="muted">—</span>'}</td>
          <td><span class="pill ${req.status?.toUpperCase() || 'PENDING'}">${(req.status||'pending').toUpperCase()}</span></td>
          <td>${req.status==='pending' ? `
              <div class="toolbar">
                <button data-act="approve" data-id="${req.id}">Approve</button>
                <button class="bad" data-act="reject" data-id="${req.id}">Reject</button>
              </div>` : '' }
          </td>
        `;
        $tbody.appendChild(tr);
      });
    }

    $tbody.addEventListener('click', async (e) => {
      const btn = e.target.closest('button[data-act]');
      if (!btn) return;
      const id = btn.getAttribute('data-id');
      const act = btn.getAttribute('data-act');
      try {
        if (act === 'approve') {
          await backendUpdate(id, { status:'approved', approvedAt: Date.now() });
          notify("Vacation approved successfully!");
        } else if (act === 'reject') {
          await backendUpdate(id, { status:'rejected', rejectedAt: Date.now() });
          notify("Vacation rejected.");
        }
      } catch(err) {
        console.error(err);
        notify("Failed to update request.");
      }
    });

    function getDatesInRange(startISO, endISO) {
      const out = [];
      const d = new Date(startISO);
      const stop = new Date(endISO);
      if (Number.isNaN(d) || Number.isNaN(stop)) return out;
      while (d <= stop) {
        out.push(d.toISOString().slice(0,10));
        d.setDate(d.getDate()+1);
      }
      return out;
    }

    async function allocateAll() {
      notify("Allocating pending requests based on seniority...", 2000);
      const items = [...state.supervisor.items].filter(r => r.status==='pending')
        .sort((a,b)=> new Date(a.seniorityDate)-new Date(b.seniorityDate));

      const allocated = new Set();
      const approved = [];
      const rejected = [];

      for (const req of items) {
        let conflict = false;
        const vds = req.vacationDates || [];
        for (const week of vds) {
          const opt = Array.isArray(week) && week[0];
          if (!opt) continue;
          for (const d of getDatesInRange(opt.startDate, opt.endDate)) {
            if (allocated.has(d)) { conflict = true; break; }
          }
          if (conflict) break;
        }
        if (conflict) rejected.push(req);
        else {
          approved.push(req);
          for (const week of vds) {
            const opt = Array.isArray(week) && week[0];
            if (!opt) continue;
            for (const d of getDatesInRange(opt.startDate, opt.endDate)) allocated.add(d);
          }
        }
      }

      await Promise.all([
        ...approved.map(r => backendUpdate(r.id, {status:'approved', approvedAt: Date.now()})),
        ...rejected.map(r => backendUpdate(r.id, {status:'rejected', rejectedAt: Date.now()})),
      ]);

      notify(`Allocated ${approved.length} request(s), rejected ${rejected.length}.`);
    }

    async function resetAll() {
      notify("Resetting all requests...", 1500);
      const updates = state.supervisor.items.map(r => backendUpdate(r.id, { status:'pending' }));
      await Promise.all(updates);
      notify(`Reset ${updates.length} request(s) to pending.`);
    }

    /*********** Backend (memory or Firestore) ***********/
    const memory = {
      _data: [],
      _autoId() { return Math.random().toString(36).slice(2,10); },
      async list() { return JSON.parse(JSON.stringify(this._data)); },
      async add(doc) { const id = this._autoId(); this._data.push({...doc, id, vacationDates: JSON.parse(doc.vacationDates)}); return id; },
      async update(id, patch) { const i = this._data.findIndex(x=>x.id===id); if (i>=0) { this._data[i] = {...this._data[i], ...patch}; } },
      ensureSeeded() {
        if (this._data.length) return;
        const seed = [
          {name:'Jane Doe', seniorityDate:'2018-05-15', vacationDates:[[{startDate:'2026-07-01',endDate:'2026-07-07'}],[{startDate:'2026-08-10',endDate:'2026-08-17'}]], yearsOfService:7, status:'pending'},
          {name:'Robert Brown', seniorityDate:'2020-03-20', vacationDates:[[{startDate:'2026-09-05',endDate:'2026-09-12'}]], yearsOfService:5, status:'pending'},
          {name:'Emily White', seniorityDate:'2012-01-10', vacationDates:[[{startDate:'2026-06-01',endDate:'2026-06-07'}],[{startDate:'2026-06-15',endDate:'2026-06-22'}],[{startDate:'2026-07-01',endDate:'2026-07-07'}]], yearsOfService:13, status:'approved'},
          {name:'Michael Green', seniorityDate:'2024-02-28', vacationDates:[[{startDate:'2026-11-01',endDate:'2026-11-08'}]], yearsOfService:1, status:'pending'},
          {name:'Olivia Jones', seniorityDate:'2019-09-01', vacationDates:[[{startDate:'2026-09-20',endDate:'2026-09-27'}],[{startDate:'2026-10-05',endDate:'2026-10-12'}]], yearsOfService:6, status:'rejected'},
        ];
        seed.forEach((s)=> this._data.push({...s, id: this._autoId()}));
      }
    };

    async function initBackend() {
      // If Firebase was loaded in the module block, it will place APIs on window._fb
      if (window._fb && window.firebaseConfig) {
        try {
          const app = window._fb.initializeApp(window.firebaseConfig);
          const auth = window._fb.getAuth(app);
          state.backend.db = window._fb.getFirestore(app);

          await new Promise((resolve) => {
            window._fb.onAuthStateChanged(auth, async (user) => {
              if (user) { state.backend.userId = user.uid; state.backend.mode='firestore'; state.backend.ready = true; resolve(); }
              else {
                try {
                  if (window.initialAuthToken) await window._fb.signInWithCustomToken(auth, window.initialAuthToken);
                  else await window._fb.signInAnonymously(auth);
                } catch(e) { console.warn("Auth failed, falling back to memory.", e); state.backend.mode='memory'; state.backend.ready = true; resolve(); }
              }
            });
          });

          // seed collection if empty (once)
          try {
            const colRef = window._fb.collection(state.backend.db, `artifacts/${state.backend.appId}/public/data/vacation_requests`);
            const snap = await window._fb.getDocs(colRef);
            if (snap.empty) {
              const samples = memory._data.length ? memory._data : (memory.ensureSeeded(), memory._data);
              for (const s of samples) {
                await window._fb.addDoc(colRef, {
                  name: s.name,
                  seniorityDate: s.seniorityDate,
                  vacationDates: JSON.stringify(s.vacationDates),
                  yearsOfService: s.yearsOfService,
                  status: s.status,
                  submittedAt: window._fb.serverTimestamp(),
                  userId: state.backend.userId
                });
              }
            }
          } catch(e) {
            // ignore seeding failure
          }
          return;
        } catch(e) {
          console.warn("Firebase init error; using memory.", e);
        }
      }
      state.backend.mode = 'memory';
      state.backend.ready = true;
      memory.ensureSeeded();
    }

    async function backendList() {
      if (state.backend.mode === 'firestore') {
        const colRef = window._fb.collection(state.backend.db, `artifacts/${state.backend.appId}/public/data/vacation_requests`);
        const q = window._fb.query(colRef);
        const out = [];
        // Single read (we avoid live onSnapshot to keep it simple)
        const snap = await window._fb.getDocs(q);
        snap.forEach(doc => {
          const d = doc.data();
          out.push({
            id: doc.id,
            ...d,
            vacationDates: d.vacationDates ? JSON.parse(d.vacationDates) : []
          });
        });
        return out;
      } else {
        return memory.list();
      }
    }

    async function backendAdd(doc) {
      if (state.backend.mode === 'firestore') {
        const colRef = window._fb.collection(state.backend.db, `artifacts/${state.backend.appId}/public/data/vacation_requests`);
        await window._fb.addDoc(colRef, doc);
      } else {
        await memory.add(doc);
      }
      await refreshSupervisor();
    }

    async function backendUpdate(id, patch) {
      if (state.backend.mode === 'firestore') {
        const ref = window._fb.doc(state.backend.db, `artifacts/${state.backend.appId}/public/data/vacation_requests`, id);
        await window._fb.updateDoc(ref, patch);
      } else {
        await memory.update(id, patch);
      }
      await refreshSupervisor();
    }

    async function refreshSupervisor() {
      state.supervisor.items = await backendList();
      paintSupervisor();
    }

    async function loadSupervisor() {
      if (!state.backend.ready) return;
      await refreshSupervisor();
    }

    /*********** Events ***********/
    // Navigation
    $('#go-employee').addEventListener('click', () => navigate('employee'));
    $('#go-supervisor').addEventListener('click', () => navigate('supervisor'));
    $('#back-from-employee').addEventListener('click', () => navigate('home'));
    $('#back-from-supervisor').addEventListener('click', () => navigate('home'));

    // Employee inputs
    $name.value = state.name;
    $seniority.value = state.seniorityDate;
    $name.addEventListener('input', e => state.name = e.target.value);
    $seniority.addEventListener('change', recomputeFromSeniority);

    // Week navigation
    $btnPrev.addEventListener('click', () => {
      if (state.currentWeekIndex>0) { state.currentWeekIndex--; paintEmployeeStats(); paintWeek(); }
    });
    $btnNext.addEventListener('click', () => {
      if (state.currentWeekIndex < state.weeks-1) { state.currentWeekIndex++; paintEmployeeStats(); paintWeek(); }
    });
    $btnSubmit.addEventListener('click', submitRequest);
    $btnAddOpt.addEventListener('click', addOption);
    $btnRemOpt.addEventListener('click', removeOption);

    // Supervisor actions
    $('#btn-allocate').addEventListener('click', allocateAll);
    $('#btn-reset').addEventListener('click', resetAll);

    // Boot
    (async function boot(){
      await initBackend();
      // initialize employee computed fields & UI
      recomputeFromSeniority();
    })();
  </script>
</body>
</html>
